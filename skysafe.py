# -*- coding: utf-8 -*-
"""SkySafe.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1-lSVAxI5Y9vm5GwgRAeJ1il0H4YHhWgS

# âœˆ **SkySafe AI - Advanced Risk Prediction Model (Prototype)**

Ø§Ù„Ù…Ø³Ø§Ø±:  Ø³Ù„Ø§Ù…Ø© ÙˆØ£Ù…Ù† Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø·ÙŠØ±Ø§Ù†

Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:  ØªÙˆØ§Ø¬Ù‡ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ© Ø®Ø·Ø± Ø§Ù„ØªØ£Ø®ÙŠØ± Ø£Ùˆ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø¬ÙˆÙŠØ© ØºÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŒ Ù…Ù…Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆÙƒÙØ§Ø¡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø­Ù„Ø§Øª.

Ø§Ù„Ø­Ù„:  Ù…Ø´Ø±ÙˆØ¹ SkySafe AI ÙŠÙ‚Ø¯Ù… Ù†Ù…ÙˆØ°Ø¬Ù‹Ø§ Ø°ÙƒÙŠÙ‹Ø§ Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø­Ø¯ÙˆØ« Ø®Ø·Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ØŒ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©. ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª ØªØ¹Ù„Ù… Ø¢Ù„ÙŠ Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ­Ù„ÙŠÙ„ Ù…ØªØºÙŠØ±Ø§Øª Ù…Ø«Ù„ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­ØŒ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©ØŒ ÙˆØ§Ù„Ù‡Ø·ÙˆÙ„ØŒ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ Ø£Ùˆ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø±

Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:  (pipeline) PythonØŒ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… PandasØŒ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø§Ù†Ø­Ø¯Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠ (Logistic Regression) Ù…Ù† Ù…ÙƒØªØ¨Ø© scikit-learnØŒ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨ØµØ±ÙŠÙ‹Ø§ Ø¹Ø¨Ø± Plotly. ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø¨Ø± Google Colab

Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:  ØªÙ…ÙƒÙŠÙ† Ù…Ø³Ø¤ÙˆÙ„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø§ØªØ®Ø§Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¨Ù†ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ ÙÙŠ Ø¸Ø±ÙˆÙ Ø¬ÙˆÙŠØ© ØµØ¹Ø¨Ø©ØŒ ÙˆØªØ­Ø³ÙŠÙ† ÙƒÙØ§Ø¡Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø­Ù„Ø§ØªØŒ ÙˆØªÙ‚Ø¯ÙŠÙ… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø¨ÙƒØ±Ø© ØªÙ‚Ù„Ù„ Ù…Ù† Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ ÙˆØªØ±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ÙÙŠ Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø·ÙŠØ±Ø§Ù†

# **DRAFT** NO. 1
"""

# SkySafe AI - Advanced Risk Prediction Model (Prototype)
# Developed for AVIthon 2025 - Semi Final Phase

import pandas as pd
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split

# ===== 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª ÙˆØ§Ù„Ø·Ù‚Ø³ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© =====
data = {
    'wind_speed': [10, 25, 35, 5, 45, 15, 28, 33, 20, 40, 12, 38, 30, 18, 27],
    'temp': [30, 22, 18, 35, 15, 27, 20, 19, 24, 16, 31, 17, 21, 29, 23],
    'precipitation': [0, 1, 1, 0, 2, 0, 1, 1, 0, 2, 0, 2, 1, 0, 1],
    'visibility': [10, 8, 6, 12, 4, 10, 7, 5, 9, 3, 11, 4, 6, 10, 7],
    'humidity': [45, 60, 80, 40, 90, 50, 65, 78, 55, 85, 42, 88, 67, 53, 70],
    'pressure': [1012, 1005, 1002, 1015, 998, 1010, 1008, 1001, 1011, 996, 1013, 997, 1006, 1014, 1007],
    'departure_hour': [6, 14, 18, 5, 21, 9, 13, 17, 7, 23, 8, 20, 16, 11, 15],
    'day_of_week': [1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 1],
    'delayed': [0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1]
}

df = pd.DataFrame(data)

# ===== 2. ÙØµÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© ÙˆØ§Ù„ØªØ§Ø¨Ø¹Ø© =====
X = df.drop(columns=['delayed'])
y = df['delayed']

# ===== 3. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø± =====
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42)

# ===== 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Pipeline =====
pipeline = Pipeline([
    ('scaler', StandardScaler()),
    ('model', RandomForestClassifier(n_estimators=100, random_state=42))
])

# ===== 5. ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ =====
pipeline.fit(X_train, y_train)

# ===== 6. ØªØ¬Ø±Ø¨Ø© ØªÙ†Ø¨Ø¤ Ù„Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© =====
new_data = pd.DataFrame({
    'wind_speed': [32],
    'temp': [20],
    'precipitation': [1],
    'visibility': [6],
    'humidity': [75],
    'pressure': [1003],
    'departure_hour': [18],
    'day_of_week': [3]
})

prediction = pipeline.predict(new_data)[0]
probability = pipeline.predict_proba(new_data)[0][1]

# ===== 7. Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© =====
print("Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø± ØªØ£Ø®ÙŠØ±ØŸ", "Ù†Ø¹Ù…" if prediction == 1 else "Ù„Ø§")
print("Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·Ø±: ", round(probability * 100, 1), "%")

"""# **DRAFT** NO. 2"""

!pip install streamlit pyngrok

# Ø­Ø°Ù Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
!rm -rf /root/.ngrok2/ngrok.yml
!rm -rf /root/.config/ngrok/ngrok.yml

from pyngrok import conf, ngrok

conf.get_default().auth_token = "30NMGFknPal0uALtvdozEPq2xm8_4Tor5Y8qFkLEGLqHQy4Vf"

!ngrok config add-authtoken 30NMGFknPal0uALtvdozEPq2xm8_4Tor5Y8qFkLEGLqHQy4Vf

# Commented out IPython magic to ensure Python compatibility.
# %%writefile skysafe_app.py
# import streamlit as st
# import matplotlib.pyplot as plt
# from sklearn.ensemble import RandomForestClassifier
# from sklearn.preprocessing import StandardScaler
# from sklearn.pipeline import Pipeline
# import numpy as np
# 
# # ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
# 
# 
# 
# st.markdown("""
#     <style>
#     .stApp {
#         background-color: #002c3d;
#     }
#     </style>
# """, unsafe_allow_html=True)
# 
# st.markdown("""
#     <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
#     <style>
#     * {
#         font-family: 'Cairo', sans-serif;
#     }
#     </style>
# """, unsafe_allow_html=True)
# 
# 
# 
# st.title("AVITHON 2025")
# st.image("SkySafe Logo.png", width=500)
# st.write("Ù†Ù…ÙˆØ°Ø¬ ØªÙ†Ø¨Ø¤ Ø¨Ø®Ø·Ø± Ø§Ù„Ø¥Ù‚Ù„Ø§Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³ ÙˆØ§Ù„Ø±Ø­Ù„Ø©")
# 
# # Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
# temp = st.slider("Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°C)", -10, 50, 25)
# wind = st.slider("Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­ (ÙƒÙ…/Ø³)", 0, 100, 20)
# humidity = st.slider("Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø·ÙˆØ¨Ø© (%)", 0, 100, 60)
# visibility = st.slider("Ù…Ø¯Ù‰ Ø§Ù„Ø±Ø¤ÙŠØ© (ÙƒÙ…)", 0, 10, 5)
# air_pressure = st.slider("Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ (hPa)", 950, 1050, 1013)
# 
# input_data = np.array([[temp, wind, humidity, visibility, air_pressure]])
# 
# # Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¨Ø³Ø· Ù„Ù„ØªØ¬Ø±Ø¨Ø©
# X = np.random.rand(100, 5) * [60, 100, 100, 10, 100] + [0, 0, 0, 0, 950]
# y = np.random.randint(0, 2, 100)
# 
# model = Pipeline([
#     ('scale', StandardScaler()),
#     ('clf', RandomForestClassifier())
# ])
# model.fit(X, y)
# 
# # Ø§Ù„ØªÙ†Ø¨Ø¤
# prediction = model.predict(input_data)[0]
# probability = model.predict_proba(input_data)[0][1]
# 
# # Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
# st.markdown("### ğŸ” Ø§Ù„Ù†ØªÙŠØ¬Ø©:")
# if prediction == 1:
#     st.error(f"âš ï¸ Potential takeoff risk detected with a probability of {round(probability*100, 1)}Ùª")
# else:
#     st.success(f"âœ… No immediate risk detected. Probability is only {round(probability*100, 1)}Ùª")
# 
# # Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ
# st.markdown("### ğŸ“Š ØªÙ…Ø«ÙŠÙ„ Ù…Ø±Ø¦ÙŠ Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·Ø±")
# fig, ax = plt.subplots()
# 
# ax.bar(["Risk probability"], [probability*100], color="crimson" if prediction else "green")
# ax.set_ylim(0, 100)
# ax.set_title("Predicted Risk Level", fontsize=14)
# ax.set_ylabel("Percentage (%)", fontsize=12)
# ax.set_xticklabels(["Risk probability"], fontsize=12)
# st.pyplot(fig)

!streamlit run skysafe_app.py &>/dev/null &

from pyngrok import ngrok

public_url = ngrok.connect(8501)
print(f"ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: {public_url}")